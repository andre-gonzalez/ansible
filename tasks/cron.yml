- name: Set cron variable when distribution is Archlinux
  tags:
    - full-install
    - light-install
    - cron
  set_fact:
    cron: cronie
  when: ansible_distribution == "Archlinux"

- name: Set cron variable when distribution is Ubuntu
  tags:
    - full-install
    - light-install
    - cron
  set_fact:
    cron: cron
  when: ansible_distribution == "Ubuntu"

- name: Install cron
  tags:
    - full-install
    - light-install
    - cron
  package:
    name: "{{ cron }}"
    state: present
    update_cache: false
  become: true

- name: start cron
  tags:
    - full-install
    - light-install
    - cron
  ansible.builtin.service:
    name: "{{ cron }}"
    state: started
    enabled: yes
  become: yes

- name: install cron job (ansible-pull)
  tags:
    - full-install
    - light-install
    - cron
  cron:
    user: ansible
    name: "ansible provision"
    minute: "*/10"
    job: "/usr/bin/ansible-pull --vault-password-file {{ lookup('env', 'HOME') }}/.vault_key -o -U https://github.com/andre-gonzalez/ansible-pull.git > /dev/null"
  become: yes

- name: install cron job (profile-selector)
  tags:
    - full-install
    - light-install
    - cron
  cron:
    user: "{{ lookup('env', 'USER') }}"
    name: "profile-selector"
    special_time: reboot
    job: "sleep 15 && DISPLAY=:0 {{ lookup('env', 'HOME') }}/.scripts/profile-selector"
  become: yes

- name: install cron job (remove downloads folder)
  tags:
    - full-install
    - light-install
    - cron
  cron:
    user: "{{ lookup('env', 'USER') }}"
    name: "remove-downloads-folder-reboot"
    special_time: reboot
    job: "sleep 60 && rm -r {{ lookup('env', 'HOME') }}/Downloads"

- name: install cron job (remove downloads folder)
  tags:
    - full-install
    - light-install
    - cron
  cron:
    user: "{{ lookup('env', 'USER') }}"
    name: "remove-downloads-folder"
    minute: "*/10"
    job: "sleep 60 && rm -r {{ lookup('env', 'HOME') }}/Downloads"

- name: install cron job (battery notification)
  tags:
    - full-install
    - light-install
    - cron
  cron:
    user: "{{ lookup('env', 'USER') }}"
    name: "battery notification"
    minute: "*/10"
    job: "/bin/sh {{ lookup('env', 'HOME') }}/.scripts/battery-warning.sh"

- name: install cron job (push fish history to git)
  tags:
    - full-install
    - light-install
    - cron
  cron:
    user: "{{ lookup('env', 'USER') }}"
    name: "push-fish-history-to-git-dotfiles"
    special_time: weekly
    job: "/bin/sh {{ lookup('env', 'USER') }}/.scripts/push-fish-history.sh"
