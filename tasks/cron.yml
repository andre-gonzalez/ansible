---
- name: Set cron variable when distribution is Archlinux
  tags:
    - full-install
    - light-install
    - cron
  ansible.builtin.set_fact:
    cron: cronie
  when: ansible_distribution == "Archlinux"

- name: Set cron variable when distribution is Ubuntu
  tags:
    - full-install
    - light-install
    - cron
  ansible.builtin.set_fact:
    cron: cron
  when: ansible_distribution == "Ubuntu"

- name: Install cron
  tags:
    - full-install
    - light-install
    - cron
  ansible.builtin.package:
    name: "{{ cron }}"
    state: present
    update_cache: false
  become: true

- name: start cron
  tags:
    - full-install
    - light-install
    - cron
  ansible.builtin.service:
    name: "{{ cron }}"
    state: started
    enabled: true
  become: true

- name: install cron job (ansible-pull)
  tags:
    - full-install
    - light-install
    - cron
  ansible.builtin.cron:
    user: ansible
    name: "ansible provision"
    minute: "*/10"
    job: "/usr/bin/ansible-pull --vault-password-file {{ lookup('env', 'HOME') }}/.vault_key -o -U https://github.com/andre-gonzalez/ansible-pull.git > /dev/null"
  become: true

- name: install cron job (profile-selector)
  tags:
    - full-install
    - light-install
    - cron
  ansible.builtin.cron:
    user: "{{ lookup('env', 'USER') }}"
    name: "profile-selector"
    special_time: reboot
    job: "sleep 15 && DISPLAY=:0 {{ lookup('env', 'HOME') }}/.scripts/profile-selector"
  become: true

- name: install cron job (remove downloads folder)
  tags:
    - full-install
    - light-install
    - cron
  ansible.builtin.cron:
    user: "{{ lookup('env', 'USER') }}"
    name: "remove-downloads-folder-reboot"
    special_time: reboot
    job: "sleep 60 && rm -r {{ lookup('env', 'HOME') }}/Downloads"

- name: install cron job (remove downloads folder)
  tags:
    - full-install
    - light-install
    - cron
  ansible.builtin.cron:
    user: "{{ lookup('env', 'USER') }}"
    name: "remove-downloads-folder"
    minute: "*/10"
    job: "sleep 60 && rm -r {{ lookup('env', 'HOME') }}/Downloads"

- name: install cron job (push fish history to git)
  tags:
    - full-install
    - light-install
    - cron
  ansible.builtin.cron:
    user: "{{ lookup('env', 'USER') }}"
    name: "push-fish-history-to-git-dotfiles"
    special_time: weekly
    job: "/bin/sh {{ lookup('env', 'USER') }}/.scripts/push-fish-history.sh"

- name: install cron job (give users access to the database)
  tags:
    - full-install
    - light-install
    - cron
    - eureciclo
  ansible.builtin.cron:
    user: "{{ lookup('env', 'USER') }}"
    name: "Give users access to the database"
    minute: "0"
    hour: "*/4"
    job: "cat $HOME/eureciclo/salesops-dw/main-salesops-dw/create-enviroment/user-groups.sql | /home/frank/.scripts/qso"

- name: install cron job (contatos pipeline)
  tags:
    - full-install
    - light-install
    - cron
    - eureciclo
  ansible.builtin.cron:
    user: "{{ lookup('env', 'USER') }}"
    name: "Contatos pipeline"
    minute: "0"
    hour: "8-20/1"
    weekday: "1-5"
    job: "cat $HOME/eureciclo/salesops-dw/main-salesops-dw/salesops-dw/star-schema/cron-job-pipeline-contacts.sql | /home/frank/.scripts/qso"
