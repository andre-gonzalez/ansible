---
- name: install tlp package
  tags:
    - full-install
    - light-install
    - save-battery
    - tlp
  ansible.builtin.package:
    name:
      - tlp # Power managment for laptop battery
      - smartmontools # Contorl and monitor hard drives
      - ethtool
    state: present
    update_cache: false
  become: true
  notify: restart tlp

- name: mask systemd-rfkill.service to avoid conflicts with TLP
  tags:
    - full-install
    - light-install
    - save-battery
    - tlp
  ansible.builtin.service:
    name: systemd-rfkill.service
    masked: true
  become: true

- name: mask systemd-rfkill.socket to avoid conflicts with TLP
  tags:
    - full-install
    - light-install
    - save-battery
    - tlp
  ansible.builtin.service:
    name: systemd-rfkill.socket
    masked: true
  become: true

- name: install powertop package
  tags:
    - full-install
    - light-install
    - save-battery
    - powertop
  ansible.builtin.package:
    name:
      - powertop # Show informations about what is consuming your battery
    state: present
    update_cache: false
  become: true
  notify: Calibrate powertop

- name: Install aur packages
  tags:
    - full-install
    - light-install
    - save-battery
    - aur
  kewlfft.aur.aur:
    name: tlpui
    use: yay
    state: present
    update_cache: true
  when: ansible_distribution == "Archlinux"
  ignore_errors: true
